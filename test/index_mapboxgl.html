<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        .marker {
            background-image: url('mapbox-icon.png');
            background-size: cover;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id='map' style='width: 800px; height: 600px;'></div>
    <script>

        let geoJSON;

        mapboxgl.accessToken = 'pk.eyJ1IjoianVhbnZhZ28iLCJhIjoiY2ttdWM4dDY0MTAzazJ4czBpNTV6cDMxMiJ9.qEA3a8YCuVqDAPrFImytlA';
        var map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/streets-v11?optimize=true', // style URL
            center: [40.463667, -3.74922], // starting position [lng, lat]
            zoom: 1, // starting zoom
            minzoom: 3,
            maxzoom: 9
        });

        fetch("https://silknow.eu/silknow/semap/semap5.min.geojson")
        .then(function (response) {
            if (!response.ok) {
            throw new Error("HTTP error " + response.status);
            }
            return response.json();
        })
        .then((json) => {
            var cont = 0;

            var start = (new Date).getTime();

            geoJSON = json;

            map.on('load', function() {
                map.addSource('points', {
                    type: 'geojson',
                    data: geoJSON
                });
            })

            geoJSON.features.forEach(function(marker) {
                    // create a HTML element for each feature
                    var el = document.createElement('div');
                    el.className = 'marker';

                    // make a marker for each feature and add to the map
                    new mapboxgl.Marker(el)
                    .setLngLat(marker.geometry.coordinates[0])
                    .addTo(map);

                    new mapboxgl.Marker(el)
                    .setLngLat(marker.geometry.coordinates[1])
                    .addTo(map);

                    cont++;
                    

            });

            console.log(cont);
            var diff = (new Date).getTime() - start;
            console.log("Tiempo total: " + diff + "ms con " + cont + " elementos");
            
        })
        .catch(function (error) {
            debugger;
            console.log(
            "Hubo un problema con la petici√≥n Fetch:" + error.message
            );
        });
    </script>
</body>
</html>

<!-- time: 4 min 53 s -->